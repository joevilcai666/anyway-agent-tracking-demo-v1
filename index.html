<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--
      Agent Actions Tracking Prototype for Anyway
      
      Core Flow:
      1. Dashboard Overview: User sees high-level metrics of their Agent's performance (Cost, Deliveries, Success Rate).
      2. Delivery List: User identifies a specific execution (Delivery) they want to investigate (e.g., high cost or failure).
      3. Trace Detail (Drill-down): User clicks a delivery to see the step-by-step execution trace, resource usage, and cost breakdown.
      
      Addresses Pain Points:
      - "Uncontrollable gross margin": Shows exact cost per delivery and per step.
      - "Optimization": Highlights slow or expensive steps.
      - "Productization": Demonstrates how a delivery is packaged as a billable unit.
    -->
    <title>Anyway - Agent Actions Tracking</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="logo-area">
                <svg class="logo-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 19H22L12 2Z" fill="currentColor"/>
                </svg>
                <span class="logo-text">Anyway</span>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item active" id="nav-dashboard">
                    <span class="nav-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="lucide" viewBox="0 0 24 24"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg></span>
                    Dashboard
                </li>
                <li class="nav-item" id="nav-products">
                    <span class="nav-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="lucide" viewBox="0 0 24 24"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg></span>
                    Product Catalog
                </li>
                <li class="nav-item" id="nav-orders">
                    <span class="nav-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="lucide" viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg></span>
                    Orders
                </li>
                <li class="nav-item" id="nav-finance">
                    <span class="nav-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="lucide" viewBox="0 0 24 24"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg></span>
                    Finance
                </li>
            </ul>

            <div class="nav-divider"></div>
            
            <div class="user-profile" id="userProfile" onclick="toggleAccountPopover(event)">
                <div class="avatar" style="background-color: hsl(var(--brand-yellow)); color: black; border: none;">J</div>
                <div class="user-info">
                    <div class="user-name">Jichun Cai</div>
                    <div class="user-email">joe@anyway.sh</div>
                </div>
            </div>
            <!-- Account Popover (Outside user-profile to avoid clipping if overflow hidden) -->
    <div id="accountPopover" class="account-popover">
        <div class="popover-header">
            <div class="avatar" style="background-color: hsl(var(--brand-yellow)); color: black; border: none;">J</div>
            <div class="user-info">
                <div class="user-name">Jichun Cai</div>
                <div class="user-email">joe@anyway.sh</div>
            </div>
        </div>
        <div class="popover-divider"></div>
        <div class="popover-item" onclick="handleAccountAction('developers')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-code-2"><path d="m18 16 4-4-4-4"/><path d="m6 8-4 4 4 4"/><path d="m14.5 4-5 16"/></svg>
            Developers
        </div>
        <div class="popover-divider"></div>
        <div class="popover-item" style="color: hsl(var(--destructive));" onclick="handleAccountAction('logout')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="lucide" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
            Sign out
        </div>
    </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard View -->
            <div id="dashboardView" class="view-content">
                <!-- SCHEME 1: Persistent Info Banner -->
                <div class="info-banner" id="sampleDataBanner">
                    <div class="banner-content">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" class="lucide" width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg></span>
                        <span class="message">You're viewing sample data</span>
                        <span class="divider">|</span>
                        <span class="sub-message">Connect Python SDK to see your first live Delivery trace</span>
                    </div>
                    <button class="banner-cta" onclick="openConnectSdkModal()">Connect Python SDK</button>
                </div>
                <header class="top-bar">
                    <div>
                        <h1>Dashboard</h1>
                        <p class="subtitle">Real-time tracking of Agent Runs & Resource Costs</p>
                    </div>
                    <div class="controls">
                        <!-- Buttons removed as per request -->
                    </div>
                </header>

                <!-- Empty State (Hidden by default) -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="empty-content">
                        <div class="empty-icon"><svg xmlns="http://www.w3.org/2000/svg" class="lucide" viewBox="0 0 24 24"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg></div>
                        <h2>No Agents Configured</h2>
                        <p>Get started by adding your first Agent to track its performance and costs.</p>
                        <button class="primary-btn large" onclick="openAddAgentModal()">+ Configure First Agent</button>
                    </div>
                </div>

                <!-- Dashboard Content Container -->
                <div id="dashboardContent">
                    <!-- Recent Deliveries Table -->
                    <section class="table-section">
                    <div class="section-header">
                        <h2>Agent Deliveries</h2>
                        <div class="table-filters">
                            <input type="text" placeholder="Search Delivery ID..." class="search-input" id="deliverySearch" onkeyup="filterDashboard()">
                            <select class="filter-select" id="deliveryStatusFilter" onchange="filterDashboard()">
                                <option value="all">All Statuses</option>
                                <option value="Success">Success</option>
                                <option value="Failed">Failed</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Delivery ID</th>
                                    <th>Timestamp</th>
                                    <th>Agent</th>
                                    <th>Status</th>
                                    <th>Steps</th>
                                    <th>Tokens</th>
                                    <th>Cost</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="runsTableBody">
                                <!-- Rows injected by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>
                </div>
            </div>

            <!-- Product Catalog View -->
            <!-- Trigger Vercel Deploy -->
            <div id="productCatalogView" class="view-content" style="display: none;">
                <header class="top-bar">
                    <div>
                        <h1>Product Catalog</h1>
                        <p class="subtitle">Manage your AI Agents as monetizable products</p>
                    </div>
                    <div class="controls">
                        <button class="primary-btn" onclick="openAddProductModal()">+ Create Product</button>
                    </div>
                </header>

                <section class="table-section">
                    <div class="section-header">
                        <h2>All Products</h2>
                        <div class="table-filters">
                            <input type="text" placeholder="Search products..." class="search-input">
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Product Name</th>
                                    <th>Linked Agent</th>
                                    <th>Price</th>
                                    <th>Strategy</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="productTableBody">
                                <!-- JS will populate this -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>

            <!-- Developers View -->
            <div id="developersView" class="view-content" style="display: none;">
                <div class="top-bar">
                    <div>
                        <h1>Developers</h1>
                        <p class="subtitle">Manage your API keys and access tokens.</p>
                    </div>
                    <button class="primary-btn" onclick="openCreateKeyModal()">
                        <span style="margin-right: 6px;">+</span> Create API key
                    </button>
                </div>

                <!-- SDK API Key Table -->
                <div class="table-section">
                    <div class="section-header">
                        <h2>SDK API Keys</h2>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">Name</th>
                                    <th style="width: 25%;">Tokens</th>
                                    <th style="width: 15%;">Status</th>
                                    <th style="width: 15%;">Created</th>
                                    <th style="width: 15%;">Last used</th>
                                    <th style="width: 5%;"></th>
                                </tr>
                            </thead>
                            <tbody id="sdkKeysTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Payment API Key Table -->
                <div class="table-section">
                    <div class="section-header">
                        <h2>Payment API Keys</h2>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">Name</th>
                                    <th style="width: 25%;">Tokens</th>
                                    <th style="width: 15%;">Status</th>
                                    <th style="width: 15%;">Created</th>
                                    <th style="width: 15%;">Last used</th>
                                    <th style="width: 5%;"></th>
                                </tr>
                            </thead>
                            <tbody id="paymentKeysTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <!-- Trace Detail Slide-over Panel -->
        <div class="slide-over-backdrop" id="tracePanelBackdrop"></div>
        <aside class="slide-over-panel" id="tracePanel">
            <div class="panel-header">
                <div class="panel-title-group">
                    <h2 id="detailDeliveryId" style="font-size: 18px; font-weight: 600;">DEL-10234</h2>
                    <span class="status-badge success" id="detailStatus" style="margin-top: 4px;">Success</span>
                </div>
                <button class="close-btn" id="closePanelBtn">&times;</button>
            </div>
            
            <div class="panel-content">
                <div class="panel-section">
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="summary-label">Total Cost</span>
                            <span class="summary-value" id="detailCost">$0.042</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Duration</span>
                            <span class="summary-value" id="detailDuration">1.2s</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Tokens</span>
                            <span class="summary-value" id="detailTokens">1,420</span>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Execution Trace</h3>
                    <div class="trace-timeline" id="traceTimeline">
                        <!-- Trace steps injected by JS -->
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3>Artifacts & Output</h3>
                    <div class="artifact-card" id="detailOutput">
                        <!-- Output injected by JS -->
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Connect SDK Modal (New) -->
    <div class="modal-backdrop" id="connectSdkBackdrop">
        <div class="modal-container">
            <div class="modal-header">
                <div class="wizard-steps" style="margin: 0; flex: 1; border: none; justify-content: flex-start; gap: 24px;">
                    <!-- Steps injected by JS or static -->
                    <div class="step active" id="sdk-step-1" style="flex: 0 0 auto; opacity: 1;">1. Get API Key</div>
                    <div class="step" id="sdk-step-2" style="flex: 0 0 auto;">2. Install SDK</div>
                    <div class="step" id="sdk-step-3" style="flex: 0 0 auto;">3. Test Trace</div>
                </div>
                <button class="close-btn" onclick="closeConnectSdkModal()">&times;</button>
            </div>

            <div class="modal-body" id="connectSdkBody">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <!-- Manage Agents Modal -->
    <div class="modal-backdrop" id="manageAgentsBackdrop">
        <div class="modal-container large">
            <div class="modal-header">
                <h2>Manage Agents</h2>
                <button class="close-btn" onclick="closeManageAgentsModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div class="manage-layout">
                    <!-- Sidebar List -->
                    <div class="manage-sidebar">
                        <div class="list-header">All Agents</div>
                        <div class="agent-list" id="agentList">
                            <!-- Injected by JS -->
                        </div>
                    </div>
                    
                    <!-- Detail View -->
                    <div class="manage-detail" id="manageDetailView">
                        <div class="empty-selection">Select an agent to edit</div>
                        <!-- Content Injected by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal-backdrop" id="addProductBackdrop">
        <div class="modal-container large">
            <div class="modal-header">
                <h2>Create New Product</h2>
                <button class="close-btn" onclick="closeAddProductModal()">&times;</button>
            </div>
            
            <div class="wizard-steps">
                <div class="step active" id="p-step1-indicator">1. Link Agent</div>
                <div class="step" id="p-step2-indicator">2. Basic Info</div>
                <div class="step" id="p-step3-indicator">3. Pricing Strategy</div>
                <div class="step" id="p-step4-indicator">4. Finish</div>
            </div>

            <div class="modal-body">
                <!-- Step 1: Link Agent -->
                <div class="step-content active" id="p-step1">
                    <div class="form-group">
                        <label>Select an Agent to Productize</label>
                        <p class="help-text">Linking an agent allows us to calculate costs automatically.</p>
                        <select class="form-select" id="productAgentSelect">
                            <option value="">-- Select an Agent --</option>
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="separator-text">OR</div>
                    <div class="option-card" id="standaloneOption" onclick="selectStandaloneProduct()">
                        <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg></div>
                        <div>
                            <div class="title">Create Standalone Product</div>
                            <div class="desc">For pure payment collection without linking to a specific agent execution.</div>
                        </div>
                        <div class="check-circle"></div>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="secondary-btn" onclick="closeAddProductModal()">Cancel</button>
                        <button class="primary-btn" onclick="productGoToStep(2)">Next</button>
                    </div>
                </div>

                <!-- Step 2: Basic Info -->
                <div class="step-content" id="p-step2">
                    <div class="form-group">
                        <label>Product Name</label>
                        <input type="text" class="form-input" id="productNameInput" placeholder="e.g., SEO Pro Plan">
                    </div>
                    <div class="form-group">
                        <label>Delivery Description</label>
                        <textarea class="form-input" id="productDescInput" rows="3" placeholder="Describe what the customer gets..."></textarea>
                    </div>
                    <div class="modal-actions">
                        <button class="secondary-btn" onclick="productGoToStep(1)">Back</button>
                        <button class="primary-btn" onclick="productGoToStep(3)">Next: Pricing</button>
                    </div>
                </div>

                <!-- Step 3: Pricing Strategy (AI) -->
                <div class="step-content" id="p-step3">
                    <div class="two-col-layout">
                        <!-- Left: Inputs -->
                        <div class="col-left">
                            <h3>Pricing Factors</h3>
                            <div class="form-group">
                                <label>Target Audience</label>
                                <select class="form-select" id="pricingAudience">
                                    <option value="b2c">Individual (B2C)</option>
                                    <option value="b2b_small">Small Team (B2B)</option>
                                    <option value="b2b_enterprise">Enterprise</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Core Value Proposition</label>
                                <input type="text" class="form-input" id="pricingUseCase" placeholder="e.g., Save 5 hours of research per week">
                            </div>
                            <div class="form-group">
                                <label>Competitor Price (Optional)</label>
                                <input type="text" class="form-input" id="pricingCompetitor" placeholder="e.g., $20/month">
                            </div>
                            <div class="form-group" id="manualCostGroup" style="display:none;">
                                <label>Estimated Cost per Unit ($)</label>
                                <input type="number" class="form-input" id="pricingCost" placeholder="0.00">
                            </div>
                             <div class="form-group">
                                <label>Desired Margin % (Optional)</label>
                                <input type="number" class="form-input" id="pricingMargin" placeholder="e.g. 50">
                            </div>
                            <button class="secondary-btn full-width" onclick="analyzePricing()">Analyze & Suggest Price</button>
                        </div>

                        <!-- Right: AI Suggestion -->
                        <div class="col-right">
                            <div id="pricingAnalysisPlaceholder" class="analysis-placeholder">
                                <span style="display: inline-block; margin-bottom: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg></span>
                                <p>Fill in the factors and click Analyze to get AI-powered pricing suggestions.</p>
                            </div>
                            <div id="pricingAnalysisResult" class="analysis-result" style="display: none;">
                                <div class="suggestion-card">
                                    <div class="suggestion-label">Recommended Range</div>
                                    <div class="suggestion-price" id="suggestedRange">$19 - $29</div>
                                    <div class="suggestion-reason" id="suggestionReason">Based on your costs ($0.40) and B2C market averages.</div>
                                </div>
                                <div class="suggestion-card secondary">
                                    <div class="suggestion-label">Anchor Price</div>
                                    <div class="suggestion-price" id="suggestedAnchor">$39</div>
                                </div>
                            </div>
                            
                            <div class="final-price-area">
                                <div class="form-group">
                                    <label>Set Final Price (USD)</label>
                                    <input type="number" class="form-input large-input" id="finalPriceInput" placeholder="0.00">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button class="secondary-btn" onclick="productGoToStep(2)">Back</button>
                        <button class="primary-btn" onclick="productGoToStep(4)">Next: Generate Link</button>
                    </div>
                </div>

                <!-- Step 4: Finish -->
                <div class="step-content" id="p-step4">
                    <div class="success-message">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5.8 11.3 2 22l10.7-3.79"/><path d="M4 3h.01"/><path d="M22 8h.01"/><path d="M15 2h.01"/><path d="M22 20h.01"/><path d="m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3v0a2.9 2.9 0 0 0 1.96 3L22 9.5"/><path d="m11 13-2.35-.7a2.9 2.9 0 0 0-3.05 1.61v0a2.9 2.9 0 0 0 1.61 3.05l.7 2.35"/><path d="M11 13a6 6 0 0 0-6 6"/><path d="M11 13 3 2"/></svg></span> Product Created Successfully!
                    </div>
                    
                    <div class="credentials-box">
                        <div class="form-group">
                            <label>Payment Link</label>
                            <div class="copy-field">
                                <input type="text" readonly value="https://pay.anyway.sh/p/seo-pro-plan" id="generatedPaymentLink">
                                <button class="copy-btn">Copy</button>
                            </div>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button class="primary-btn" onclick="finishAddProduct()">Done</button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- Create API Key Modal -->
    <div id="createKeyBackdrop" class="modal-backdrop">
        <div class="modal-container">
            <div class="modal-header">
                <h2>Create API key</h2>
                <button class="close-btn" onclick="closeCreateKeyModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <!-- Step 1: Input -->
                <div id="createKeyFormStep">
                    <div class="form-group">
                        <label>Type</label>
                        <div style="border: 1px solid hsl(var(--border)); border-radius: var(--radius); padding: 12px; margin-bottom: 8px; cursor: pointer;" onclick="document.getElementById('typeSdk').checked = true">
                            <div style="display: flex; align-items: flex-start; gap: 8px;">
                                <input type="radio" name="keyType" id="typeSdk" value="sdk" checked style="margin-top: 4px;">
                                <div>
                                    <div style="font-weight: 500; font-size: 13px;">SDK API Key</div>
                                    <div style="font-size: 12px; color: hsl(var(--muted-foreground));">Used for tracing agent data</div>
                                </div>
                            </div>
                        </div>
                        <div style="border: 1px solid hsl(var(--border)); border-radius: var(--radius); padding: 12px; cursor: pointer;" onclick="document.getElementById('typePayment').checked = true">
                            <div style="display: flex; align-items: flex-start; gap: 8px;">
                                <input type="radio" name="keyType" id="typePayment" value="payment" style="margin-top: 4px;">
                                <div>
                                    <div style="font-weight: 500; font-size: 13px;">Payment API Key</div>
                                    <div style="font-size: 12px; color: hsl(var(--muted-foreground));">Used for querying payment data and verifying user status</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="newKeyName">Name</label>
                        <input type="text" id="newKeyName" class="form-input" placeholder="e.g. Production Key">
                    </div>
                    
                    <div class="form-group">
                        <label>Expiration</label>
                        <select class="form-select" disabled style="background-color: hsl(var(--muted)); cursor: not-allowed;">
                            <option>Never expires (Coming soon)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Permissions</label>
                        <div style="padding: 12px; background-color: hsl(var(--muted)); border-radius: var(--radius); border: 1px solid hsl(var(--border)); color: hsl(var(--muted-foreground)); font-size: 13px;">
                            Detailed permission scopes coming soon
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button class="secondary-btn" onclick="closeCreateKeyModal()">Cancel</button>
                        <button class="primary-btn" id="createKeyBtn" onclick="generateKey()">Create secret key</button>
                    </div>
                </div>

                <!-- Step 2: Success -->
                <div id="createKeyResultStep" style="display: none;">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="width: 48px; height: 48px; background: hsl(var(--success-bg)); color: hsl(var(--success)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check"><path d="M20 6 9 17l-5-5"/></svg>
                        </div>
                        <h3 style="margin: 0 0 8px 0; font-size: 18px;">Your New API Key</h3>
                        <p style="margin: 0; color: hsl(var(--muted-foreground)); font-size: 13px;">
                            Keep your key safe: Save and store this new key to a secure place, such as a password manager or secret store. You won't be able to see it again.
                        </p>
                    </div>

                    <div class="form-group">
                        <label>Secret Key</label>
                        <div class="copy-field">
                            <input type="text" id="newKeySecret" readonly>
                            <button class="copy-btn" onclick="copyNewKey()">Copy</button>
                        </div>
                        <p style="margin: 8px 0 0 0; color: hsl(var(--warning)); font-size: 12px; display: flex; align-items: center; gap: 4px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-alert-triangle"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                            This key will be shown only once. Copy and store it securely.
                        </p>
                    </div>

                    <div class="modal-actions" style="justify-content: space-between;">
                        <button class="secondary-btn" onclick="downloadEnvSnippet()">Download as .env snippet</button>
                        <button class="primary-btn" onclick="closeCreateKeyModal()">Done</button>
                    </div>
                </div>

                <!-- Step 3: Error -->
                <div id="createKeyErrorStep" style="display: none; text-align: center; padding: 20px 0;">
                    <div style="width: 48px; height: 48px; background: #fee2e2; color: #ef4444; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </div>
                    <h3 style="margin: 0 0 8px 0; font-size: 18px;">Creation Failed</h3>
                    <p style="margin: 0 0 24px 0; color: hsl(var(--muted-foreground)); font-size: 13px;">
                        Something went wrong while creating your key. Please try again.
                        <br>
                        <span style="font-family: 'Geist Mono', monospace; font-size: 12px;">Error: NETWORK_ERR_001</span>
                    </p>
                    <button class="primary-btn" onclick="generateKey()">Try Again</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
