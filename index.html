<!DOCTYPE html>
<html lang="en">
<!--
  Agent Actions Tracking Prototype for Anyway
  
  Core Flow:
  1. Dashboard Overview: User sees high-level metrics of their Agent's performance (Cost, Deliveries, Success Rate).
  2. Delivery List: User identifies a specific execution (Delivery) they want to investigate (e.g., high cost or failure).
  3. Trace Detail (Drill-down): User clicks a delivery to see the step-by-step execution trace, resource usage, and cost breakdown.
  
  Addresses Pain Points:
  - "Uncontrollable gross margin": Shows exact cost per delivery and per step.
  - "Optimization": Highlights slow or expensive steps.
  - "Productization": Demonstrates how a delivery is packaged as a billable unit.
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anyway - Agent Actions Tracking</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="logo-area">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 19H22L12 2Z" fill="currentColor"/>
                </svg>
                <span class="logo-text">Anyway</span>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item active" id="nav-dashboard">
                    <span class="nav-icon">üìä</span>
                    Dashboard
                </li>
                <li class="nav-item" id="nav-products">
                    <span class="nav-icon">üì¶</span>
                    Product Catalog
                </li>
                <li class="nav-item" id="nav-orders">
                    <span class="nav-icon">üìÑ</span>
                    Orders
                </li>
                <li class="nav-item" id="nav-finance">
                    <span class="nav-icon">üí∞</span>
                    Finance
                </li>
            </ul>

            <div class="nav-divider"></div>
            
            <div class="user-profile" id="userProfile">
                <div class="avatar">D</div>
                <div class="user-info">
                    <div class="user-name">demo</div>
                    <div class="user-email">demo@anyway.sh</div>
                </div>
                <div class="settings-icon" id="settingsIcon">‚öôÔ∏è</div>
                
                <!-- Settings Dropdown -->
                <div class="settings-dropdown" id="settingsDropdown">
                    <div class="dropdown-header">
                        <div class="user-name">demo</div>
                        <div class="user-email">demo@anyway.sh</div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" id="menuApiKeys">
                        <span class="icon">üîë</span> API Keys
                    </div>
                    <div class="dropdown-item">
                        <span class="icon">üë§</span> Profile
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item">
                        <span class="icon">üö™</span> Logout
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard View -->
            <div id="dashboardView">
                <header class="top-bar">
                    <div>
                        <h1>Dashboard</h1>
                        <p class="subtitle">Real-time tracking of Agent Runs & Resource Costs</p>
                    </div>
                    <div class="controls">
                        <button class="secondary-btn" id="manageAgentsBtn" style="margin-right: 8px;">Settings</button>
                        <button class="primary-btn" id="addAgentBtn">+ Add Agent</button>
                        <div class="date-picker" style="margin-left: 16px;">
                            <span>üìÖ Today: Dec 25</span>
                        </div>
                    </div>
                </header>

                <!-- Empty State (Hidden by default) -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="empty-content">
                        <div class="empty-icon">ü§ñ</div>
                        <h2>No Agents Configured</h2>
                        <p>Get started by adding your first Agent to track its performance and costs.</p>
                        <button class="primary-btn large" onclick="openAddAgentModal()">+ Configure First Agent</button>
                    </div>
                </div>

                <!-- Dashboard Content Container -->
                <div id="dashboardContent">
                    <!-- KPI Cards -->
                <section class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-label">Total Deliveries</div>
                        <div class="kpi-value">1,248</div>
                        <div class="kpi-trend positive">‚Üó 12% vs yesterday</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">Total Cost</div>
                        <div class="kpi-value">$42.80</div>
                        <div class="kpi-trend neutral">‚Üí Stable</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">Avg. Margin</div>
                        <div class="kpi-value">68%</div>
                        <div class="kpi-trend positive">‚Üó 2% vs yesterday</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">Success Rate</div>
                        <div class="kpi-value error-text">94.2%</div>
                        <div class="kpi-trend negative">‚Üò 1.5% vs yesterday</div>
                    </div>
                </section>

                <!-- Main Chart Area (Simplified Visualization) -->
                <section class="chart-section">
                    <div class="section-header">
                        <h2>Cost & Usage Analysis</h2>
                        <div class="tabs">
                            <button class="tab active">Daily</button>
                            <button class="tab">Weekly</button>
                            <button class="tab">Monthly</button>
                        </div>
                    </div>
                    <div class="chart-placeholder" id="mainChart">
                        <!-- Bars injected by JS -->
                    </div>
                </section>

                <!-- Recent Deliveries Table -->
                <section class="table-section">
                    <div class="section-header">
                        <h2>Agent Deliveries</h2>
                        <div class="table-filters">
                            <input type="text" placeholder="Search Delivery ID..." class="search-input">
                            <select class="filter-select">
                                <option>All Statuses</option>
                                <option>Success</option>
                                <option>Failed</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Delivery ID</th>
                                    <th>Timestamp</th>
                                    <th>Deliverable / Customer</th>
                                    <th>Status</th>
                                    <th>Steps</th>
                                    <th>Tokens</th>
                                    <th>Cost</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="runsTableBody">
                                <!-- Rows injected by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>
                </div>
            </div>

            <!-- API Keys View -->
            <div id="apiKeysView" style="display: none;">
                <header class="top-bar">
                    <div>
                        <h1>API Keys</h1>
                    </div>
                </header>

                <section class="table-section">
                    <div class="section-header" style="justify-content: space-between;">
                        <input type="text" placeholder="Search via name" class="search-input" style="width: 320px;">
                        <button class="primary-btn">+ Add API Key</button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Key</th>
                                    <th>Webhook secret</th>
                                    <th>Created</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="apiKeysTableBody">
                                <!-- JS will populate this -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>

        <!-- Trace Detail Slide-over Panel -->
        <div class="slide-over-backdrop" id="tracePanelBackdrop"></div>
        <aside class="slide-over-panel" id="tracePanel">
            <div class="panel-header">
                <div class="panel-title-group">
                    <h2 id="detailDeliveryId">DEL-10234</h2>
                    <span class="status-badge success" id="detailStatus">Success</span>
                </div>
                <button class="close-btn" id="closePanelBtn">√ó</button>
            </div>
            
            <div class="panel-content">
                <div class="panel-section summary">
                    <div class="detail-item">
                        <label>Total Cost</label>
                        <span class="value cost" id="detailCost">$0.042</span>
                    </div>
                    <div class="detail-item">
                        <label>Duration</label>
                        <span class="value" id="detailDuration">1.2s</span>
                    </div>
                    <div class="detail-item">
                        <label>Tokens</label>
                        <span class="value" id="detailTokens">1,420</span>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Execution Trace</h3>
                    <div class="trace-timeline" id="traceTimeline">
                        <!-- Trace steps injected by JS -->
                    </div>
                </div>
                
                <div class="panel-section">
                    <h3>Artifacts & Output</h3>
                    <div class="code-block" id="detailOutput">
                        <!-- Output injected by JS -->
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Add Agent Modal -->
    <div class="modal-backdrop" id="addAgentBackdrop">
        <div class="modal-container">
            <div class="modal-header">
                <h2>Configure New Agent</h2>
                <button class="close-btn" onclick="closeAddAgentModal()">√ó</button>
            </div>
            
            <div class="wizard-steps">
                <div class="step active" id="step1-indicator">1. Add Provider Key</div>
                <div class="step" id="step2-indicator">2. Agent Info</div>
                <div class="step" id="step3-indicator">3. Get Credentials</div>
            </div>

            <div class="modal-body">
                <!-- Step 1: Add LLM Provider Key -->
                <div class="step-content active" id="step1">
                    <div class="form-group">
                        <label>LLM Provider</label>
                        <select class="form-select" id="providerSelect">
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="gemini">Gemini</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Key Label</label>
                        <input type="text" class="form-input" id="keyLabelInput" placeholder="e.g., My Production Key">
                    </div>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" class="form-input" id="apiKeyInput" placeholder="sk-...">
                    </div>
                    <div class="modal-actions">
                        <button class="secondary-btn" onclick="closeAddAgentModal()">Cancel</button>
                        <button class="primary-btn" onclick="goToStep(2)">Next: Agent Info</button>
                    </div>
                </div>

                <!-- Step 2: Agent Info -->
                <div class="step-content" id="step2">
                    <div class="form-group">
                        <label>Agent Name</label>
                        <input type="text" class="form-input" id="agentNameInput" placeholder="e.g., Customer Support Bot">
                    </div>
                    <div class="form-group">
                        <label>Description (Optional)</label>
                        <textarea class="form-input" id="agentDescInput" rows="2" placeholder="Brief description..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Associate Provider Keys</label>
                        <div class="key-selection-list" id="keySelectionList">
                            <!-- Injected by JS -->
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="secondary-btn" onclick="goToStep(1)">Back</button>
                        <button class="primary-btn" onclick="goToStep(3)">Next: Generate Credentials</button>
                    </div>
                </div>

                <!-- Step 3: Credentials -->
                <div class="step-content" id="step3">
                    <div class="success-message">
                        <span class="icon">‚úÖ</span> Agent Configured Successfully!
                    </div>
                    
                    <div class="credentials-box">
                        <div class="form-group">
                            <label>Anyway API Key</label>
                            <div class="copy-field">
                                <input type="text" readonly value="any_wk_89234789234..." id="generatedAnywayKey">
                                <button class="copy-btn">Copy</button>
                            </div>
                            <p class="help-text">Please save this key securely. It will not be shown again.</p>
                        </div>
                        <div class="form-group">
                            <label>Anyway Base URL</label>
                            <div class="copy-field">
                                <input type="text" readonly value="https://api.anyway.sh/v1/openai" id="generatedBaseUrl">
                                <button class="copy-btn">Copy</button>
                            </div>
                        </div>
                    </div>

                    <div class="code-integration">
                        <h4>Integration Example</h4>
                        <div class="code-block" style="background: #f4f4f5; color: #333; border: 1px solid #e4e4e7;">
const client = new OpenAI({
  apiKey: "<span style="color:#059669">ANYWAY_API_KEY</span>",
  baseURL: "<span style="color:#059669">https://api.anyway.sh/v1/openai</span>"
});
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button class="secondary-btn" onclick="testConnection()">Test Connection</button>
                        <button class="primary-btn" onclick="finishAddAgent()">Done</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Agents Modal -->
    <div class="modal-backdrop" id="manageAgentsBackdrop">
        <div class="modal-container large">
            <div class="modal-header">
                <h2>Manage Agents</h2>
                <button class="close-btn" onclick="closeManageAgentsModal()">√ó</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div class="manage-layout">
                    <!-- Sidebar List -->
                    <div class="manage-sidebar">
                        <div class="list-header">All Agents</div>
                        <div class="agent-list" id="agentList">
                            <!-- Injected by JS -->
                        </div>
                    </div>
                    
                    <!-- Detail View -->
                    <div class="manage-detail" id="manageDetailView">
                        <div class="empty-selection">Select an agent to edit</div>
                        <!-- Content Injected by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
