### 用户画像与解决的核心问题

- 用户画像：使用 AI 交付可计量成果,并将交付物产品化/服务化收费的**`个人开发者与小团队`**,包括: AI Agency (AI 代理服务商)；Freelancer；小型 SaaS 团队；Agent Studio
- 解决的问题/JTBD
    - 我想按“客户/项目/一次交付”准确计算这单的真实成本与毛利，不用靠拍脑袋定价
    - 我想知道 agent 在交付过程中：做了啥，哪里最贵/最慢/最容易失败 → 好优化成本与稳定性
    - 我想把交付过程“产品化”：把一次交付变成可复用的服务单元（可比较、可报价、可复盘）
    - 我想给我的用户一个可解释的账单依据：为什么收这个价（价值）+ 为什么成本这么高（用量/资源）
    - 我想在不大改代码的情况下快速接入追踪，并且能用于后续自动定价与收款

---

### 「Agent 行为追踪」方案思路

### 一、核心定义

<aside>

Agent 一次交付（Delivery）= 一段可重放的执行轨迹（Trace）+ 一组资源消耗（Usage）+ 一组成本口径（Cost）+ 一组可解释产物（Artifacts）

</aside>

**可解释产物说明：**指交付过程中产生的可供用户理解的输出，如生成的文档、分析报告、API 响应结果等，用于向最终用户解释"Agent 做了什么"

### 二、关键问题

**问题 1：数据隐私与信任**

- 拿 Trace 意味着可能获取所有执行数据，存在隐私泄露风险
- 客户是否愿意接受这种侵入性？如何建立信任？

**问题 2：接入成本与用户体验**

- 不能要求用户手动下载 OpenTelemetry 并嵌入复杂的 agent 系统
- 如何让客户低成本、便捷地接入追踪能力？
- 如何在不大幅改动代码的情况下实现监控？

**问题 3：数据完整性**

- 如何监控 agent 的行为？能获取哪些维度的数据？
- 如何确保数据的准确性和可追溯性？

**问题 4：用户感知**

- 如何让客户（开发者）和他们的最终用户都能理解 agent 的执行过程？
- Dashboard 如何清晰呈现复杂的追踪信息？

### 三、数据获取方案对比

我们提供四种技术方案，每种方案在接入难度、数据完整性、隐私风险、开发成本上各有权衡：

**方案 1：提供 SDK**

- 客户接入方式：在代码中集成我们的 SDK，通过代码埋点上报数据
- 优势
    - 数据完整性高：能获取完整的 agent 执行轨迹和详细信息
    - 灵活性强：客户可以自定义上报的数据粒度
- 劣势
    - 侵入性大：需要修改客户代码，存在隐私顾虑
    - 信任门槛高：客户为什么要相信我们不滥用数据？
    - 接入成本高：对客户的技术能力有一定要求
- 我方开发成本：中等（需要开发多语言 SDK 和文档）
- MVP 适用性：中等，适合技术能力强且有深度定制需求的客户

**方案 2：提供可本地下载的 Package（基于 OpenTelemetry + LangChain）**

- **客户接入方式：**本地下载我们封装好的 package，配置 API Key 和 endpoint，自动采集 LangChain/Agent 框架的追踪数据
- **优势**
    - 标准化：基于 OP+LC 标准，兼容性好, 不用重复造轮子
    - 自动化程度高：减少手动埋点工作
    - 数据完整性较高：能捕获框架层面的执行信息
- **劣势**
    - 仍需修改代码：客户需要引入 package 并配置
    - 依赖特定框架：主要支持 LangChain 等主流框架
- **我方开发成本：可能**高？（需要深度集成 LangChain + OpenTelemetry，并持续维护兼容性）
- **MVP 适用性：**较高，平衡了易用性和数据质量，适合使用主流 Agent 框架的客户

**方案 3：提供 Gateway（代理层）**

- **客户接入方式：**将调用 API 时的路由到我们的 Gateway；不太确定是否本地下载，但可能需要修改 API endpoint 配置；Agent 本身 workflow 每一步都需要通过 API 去请求
- **优势**
    - （不一定，待调研）部署简单：客户无需下载安装，只需改配置
    - 成本低：我们提供更低价的模型 tokens，又提供给客户更多 incentives
- **劣势**
    - 增加延迟：请求需经过我们的服务器，可能影响响应速度
    - 单点风险：Gateway 故障会影响客户服务
- **我方开发成本：可能**高？（需要构建高可用的 Gateway 基础设施）
- **MVP 适用性：可能是最优解，但不太确定，取绝于技术上是否好实现**

**方案 4：Post 上报 + 记账本模式**

- **客户接入方式：**客户自行采集数据，通过我们提供的 API 主动上报关键事件和用量信息
- **优势**
    - 隐私友好：客户完全控制上报什么数据，信任成本最低
    - 接入灵活：不限制技术栈和框架
    - 轻量级：对客户代码侵入性最小
    - 我方开发成本低：只需提供数据接收 API 和简单文档
- **劣势**
    - 最大问题：要实现自动化上报，那也就是 Gateway 的逻辑了
    - 数据完整性弱：依赖客户正确采集和上报
    - 数据真实性无法保证：客户可能上报不准确的数据（没有太大影响，客户有 incentives 去提供准确的数据）
    - 需要客户理解数据模型：有一定学习成本（但前端设计上可解决）
- **MVP 适用性：不太行，还是得走 Gateway 的逻辑**

<aside>
💡

Dashboard 用户体验侧/前端展示的方式取决于我们对于上面方案的选择

</aside>

### 四、Dashboard 集成策略、方案雏形

**核心原则**

- 强曝光：「Agent 行为追踪」功能必须在 Dashboard 首页可见，不能折叠到子导航
- 渐进式展示：从总览到详情，支持 drill-down 查询

**信息架构建议**

- **总览卡片**（Dashboard 顶部）
    - 展示关键指标：总交付次数、总成本、平均耗时、成功率
    - 快速筛选：按时间、项目、客户维度过滤
- **交付列表**（主体区域）
    - 每条记录显示：Delivery ID、时间、客户、状态、成本、耗时
    - 点击进入详情页，查看完整 Trace 和 Usage 分解
- **成本分析视图**（可选 Tab）
    - 按步骤/模型/供应商拆分成本
    - 支持从总成本 drill-down 到单个 API 调用

**Agent 交付过程中能被观测到的**

- 时间 ：开始/结束、每一步耗时、排队/重试时间
- 资源消耗 ：每一步 LLM tokens、图片像素/秒、向量检索次数、外部 API 次数、CPU/GPU 时间（可先不做）、存储/带宽（可先不做）
- 失败 ：错误码、重试次数、超时、降级路径等
- 归属关系 ：这些消耗到底属于哪个用户/项目/交付/版本

> 交付本质是：本把每一次交付的 “资源账单” 归集到正确的业务对象上，并能复盘过程
> 

**交付过程拆解成具体的组成部分**

- 对象（Identity） ： Agent 执行谁的任务？任务中包含了哪些对象？
- 事件（Events） ：执行任务中，Agent 干了啥？
- 成本口径（Costing） ：花了多少钱？usage → cost 的映射
    - 可以考虑增加「聚合查询」的逻辑：按交付汇总成本、耗时、失败；按步骤/供应商拆分
    - 能从总成本 drill-down 到“哪一步、用的什么模型、多少 tokens、多少钱”

**业务对象**

- Delivery ：一次可收费/可复盘的交付单元（ Agent 交付物）
- Run ：Delivery 的一次执行（可能重试/多次）
- Span/Step ：Run 内的一步（LLM 调用、工具调用、检索、爬取、代码执行等）
- Usage ：可计量消耗（tokens、requests、seconds…）
- CostLineItem ：Usage 经过定价表计算出来的成本行（可回溯版本）